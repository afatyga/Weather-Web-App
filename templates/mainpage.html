<!doctype html>
<html>
<head>

	<style>
		h1{
			font-family: "Courier New", Courier, monospace;
		}
		body{
			background: linear-gradient(lightgoldenrodyellow, cornflowerblue);
		}
	</style>


    <title>wEaThEr FuN</title>
    <meta name="google-signin-client_id" content="290222337069-bu7nk4bu89fs0gqs6vr1jebnqp6aas59.apps.googleusercontent.com">

    <!-- This script is about google account single sign in -->
    <script src="https://apis.google.com/js/platform.js" async defer> 
        gapi.load('auth2', function() {
	        gapi.auth2.init();
        });
        </script>
</head>
    <!-- Displaying on the main page -->
    <h1 align="center">Your Weather, Our Sensor</h1>
    <p id="weather"></p>
    <div id="signin" class="g-signin2" data-onsuccess="signIn" align="center"></div>
    <div style="text-align: center;"><a id ="signout" href="#" onclick="signOut();">Sign out</a></div>

    <!--This script is used for logging out the user-->
    <script>
        function signOut() { //log out user and turn off graph
            var auth = gapi.auth2.getAuthInstance();
            auth.signOut().then(function () {
 	            window.location.reload();
        });
        }
    </script>

    <script>
        function renderButton() {
            gapi.signin2.render('signin', {
                'width' : 50,
                'height': 50,
                'onfailure' : onFailure
            })
        }
    </script>

    <!-- This <div> is to display the timezone, temperature, and humidity on web page-->
    <!-- The <div> is to display the data reading from Dark Sky API -->
    <div class = "info">
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class = "first">In your current location, it is </span>
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class = "descript"></span>
    </div>
    <div class = "temperature">
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class = "title1"> The current temperature is </span>
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class="degree"></span>
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class="temp-type">°F</span>
    </div>
    <div class = "humidd">
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class="title 2">The current humidity is </span>
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class = "humid"></span>
        <span style = "font-size: 18p; font-family:Courier New, Courier, monospace" class="percent">%</span>
    </div>

    <!-- This script is to get the data from Dark Sky Api as well as the device's location -->
    <script type="text/javascript">
        window.addEventListener('load', () => {
            let long; // longitude
            let lat; // latitude
            let detail = document.querySelector(".descript"); // Description of the weather
            let tempdegree = document.querySelector(".degree"); // tempdegree => degree class
            let humidpercent = document.querySelector(".humid"); // humidpercent => humid class

            if(navigator.geolocation) { // Find the longitude and latitude of the device
              navigator.geolocation.getCurrentPosition(position => {
                    long = position.coords.longitude;
                    lat = position.coords.latitude;

                    const proxy = 'https://cors-anywhere.herokuapp.com/';
                    const api = proxy+'https://api.darksky.net/forecast/e7d8d22d4d7468930b5ffc9d4cb56a9e/'+lat+','+long; // Dark Sky API

                    fetch(api)
                        .then(response => {
                            return response.json(); // Fetch the Dark Sky API and display json data
                    })
                        .then(data => {
                            console.log(data);
                            tempdegree.textContent = data.currently.temperature; // Input the temperature from data to html
                            let hum2per = data.currently.humidity * 100; // Function to transform the decimal points to percentage of the humidity
                            humidpercent.textContent = hum2per; // Get converted humidity data and send to html
                            detail.textContent = data.currently.summary;

                        });
                    });
                }
            });
    </script>

<head>
    <p> <br></p>
    <p> <br></p>
</head>

    <div id="tempgraph" style="height: 325px; width: 80%;"align="center"></div>
    <div align="center" id="tempgraph" style="height: 300px; width: 60%;"></div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<!--<div class = "sensor">
        <span style = "text-align: center; font-family:Courier New, Courier, monospace" class="title 2">And data coming live from our sensor shows ... </span>
    </div>-->

<script> // This script is to display the graph of temperature and humidity

function signIn(){ 
	var t = {{temp| tojson|safe}};

//	window.onload = function () {


	var chart = new CanvasJS.Chart("tempgraph", {
	animationEnabled: true,
	theme: "light2", // theme of the graph
	title:{
		text: "Temperature vs. Humidity" // Title of the graph
	},
    toolTip: { // Create a little box when the point on the graph is hovered over
	    shared: true,
        content: "<strong>Temperature:</strong> {y} °F </br><strong>Humidity:</strong> {x} %"
    },
    axisY: { // formatting y-axis
	    title: "Temperature",
        suffix: "°F"
    },
    axisX: { // formatting x-axis
	    suffix: "%",
        title: "Humidity"
    },
	data: [ // input data to plot the graph -> need to git data from else where
      {
        type: "scatter",
        dataPoints: [ //y (temperature) comes from the database and x is randomized values so that there are multiple sensors per user
        { x: (Math.random() * 100), y: t[0] },
        { x: (Math.random() * 100), y: t[1] },
        { x: (Math.random() * 100), y: t[2] },
        { x: (Math.random() * 100), y: t[3] },
        { x: (Math.random() * 100), y: t[5] },
        { x: (Math.random() * 100), y: t[6] },
        { x: (Math.random() * 100), y: t[7] },       
        { x: (Math.random() * 100), y: t[8] },
        { x: (Math.random() * 100), y: t[9] },
        { x: (Math.random() * 100), y: t[10] },
        { x: (Math.random() * 100), y: t[11] },
        { x: (Math.random() * 100), y: t[12] },
        { x: (Math.random() * 100), y: t[13] },
        { x: (Math.random() * 100), y: t[14] },
        { x: (Math.random() * 100), y: t[15] }
        ]
      }
    ]

	});
	chart.render();
//}
}


function onFailure(error) {
    console.log(error);
}
</script>


</body>
</html>
